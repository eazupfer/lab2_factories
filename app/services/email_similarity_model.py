{"filter":false,"title":"email_similarity_model.py","tooltip":"/lab2_factories/app/services/email_similarity_model.py","undoManager":{"mark":2,"position":2,"stack":[[{"start":{"row":0,"column":0},"end":{"row":42,"column":0},"action":"insert","lines":["import json","import numpy as np","from sklearn.metrics.pairwise import cosine_similarity","","class EmailSimilarityModel:","    \"\"\"Classify emails by comparing with stored emails using cosine similarity\"\"\"","","    def __init__(self, emails_file=\"data/emails.json\"):","        self.emails_file = emails_file","        try:","            with open(self.emails_file, \"r\") as f:","                self.stored_emails = json.load(f)  # expect list of {subject, body, embedding, ground_truth}","        except FileNotFoundError:","            self.stored_emails = []","","    def _get_embedding(self, email_text: str) -> np.ndarray:","        \"\"\"Convert email text into an embedding (placeholder â€” replace with real model)\"\"\"","        # For now: use length of text as embedding (simple numeric feature)","        return np.array([len(email_text)])","","    def classify_by_similarity(self, subject: str, body: str):","        \"\"\"Find the most similar stored email\"\"\"","        input_text = subject + \" \" + body","        input_embedding = self._get_embedding(input_text).reshape(1, -1)","","        if not self.stored_emails:","            return None  # no emails stored yet","","        # Compare with all stored email embeddings","        similarities = []","        for email in self.stored_emails:","            stored_embedding = np.array(email[\"embedding\"]).reshape(1, -1)","            score = cosine_similarity(input_embedding, stored_embedding)[0][0]","            similarities.append((email, score))","","        # Pick best match","        best_match, best_score = max(similarities, key=lambda x: x[1])","","        return {","            \"matched_email\": best_match,","            \"similarity_score\": best_score","        }",""],"id":1}],[{"start":{"row":38,"column":4},"end":{"row":38,"column":8},"action":"remove","lines":["    "],"id":2}],[{"start":{"row":38,"column":4},"end":{"row":38,"column":8},"action":"insert","lines":["    "],"id":3}]]},"ace":{"folds":[],"scrolltop":120,"scrollleft":0,"selection":{"start":{"row":42,"column":0},"end":{"row":42,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":30,"state":"start","mode":"ace/mode/python"}},"timestamp":1758501724285,"hash":"193e0db8ead173d3bfcbcb5142a01e972cb17d46"}