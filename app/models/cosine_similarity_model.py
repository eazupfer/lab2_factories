{"changed":true,"filter":false,"title":"cosine_similarity_model.py","tooltip":"/lab2_factories/app/models/cosine_similarity_model.py","value":"import json\nimport numpy as np\nfrom sklearn.metrics.pairwise import cosine_similarity\n\nclass EmailSimilarityModel:\n    \"\"\"Classify emails by comparing with stored emails using cosine similarity\"\"\"\n    #Classification by email-to-email similarity (cosine similarity with stored emails)\n\n    def __init__(self, emails_file=\"data/emails.json\"):\n        self.emails_file = emails_file\n        try:\n            with open(self.emails_file, \"r\") as f:\n                self.stored_emails = json.load(f)  # expect list of {subject, body, embedding, ground_truth}\n        except FileNotFoundError:\n            self.stored_emails = []\n\n    def _get_embedding(self, email_text: str) -> np.ndarray:\n        \"\"\"Convert email text into an embedding (placeholder — replace with real model)\"\"\"\n        # For now: use length of text as embedding (simple numeric feature)\n        return np.array([len(email_text)])\n\n    def classify_by_similarity(self, subject: str, body: str):\n        \"\"\"Find the most similar stored email\"\"\"\n        input_text = subject + \" \" + body\n        input_embedding = self._get_embedding(input_text).reshape(1, -1)\n\n        if not self.stored_emails:\n            return None  # no emails stored yet\n\n        # Compare with all stored email embeddings\n        similarities = []\n        for email in self.stored_emails:\n            stored_embedding = np.array(email[\"embedding\"]).reshape(1, -1)\n            score = cosine_similarity(input_embedding, stored_embedding)[0][0]\n            similarities.append((email, score))\n\n        # Pick best match\n        best_match, best_score = max(similarities, key=lambda x: x[1])\n\n        return {\n            \"matched_email\": best_match,\n            \"similarity_score\": best_score\n        }\n","undoManager":{"mark":-2,"position":17,"stack":[[{"start":{"row":0,"column":0},"end":{"row":42,"column":0},"action":"insert","lines":["import json","import numpy as np","from sklearn.metrics.pairwise import cosine_similarity","","class EmailSimilarityModel:","    \"\"\"Classify emails by comparing with stored emails using cosine similarity\"\"\"","","    def __init__(self, emails_file=\"data/emails.json\"):","        self.emails_file = emails_file","        try:","            with open(self.emails_file, \"r\") as f:","                self.stored_emails = json.load(f)  # expect list of {subject, body, embedding, ground_truth}","        except FileNotFoundError:","            self.stored_emails = []","","    def _get_embedding(self, email_text: str) -> np.ndarray:","        \"\"\"Convert email text into an embedding (placeholder — replace with real model)\"\"\"","        # For now: use length of text as embedding (simple numeric feature)","        return np.array([len(email_text)])","","    def classify_by_similarity(self, subject: str, body: str):","        \"\"\"Find the most similar stored email\"\"\"","        input_text = subject + \" \" + body","        input_embedding = self._get_embedding(input_text).reshape(1, -1)","","        if not self.stored_emails:","            return None  # no emails stored yet","","        # Compare with all stored email embeddings","        similarities = []","        for email in self.stored_emails:","            stored_embedding = np.array(email[\"embedding\"]).reshape(1, -1)","            score = cosine_similarity(input_embedding, stored_embedding)[0][0]","            similarities.append((email, score))","","        # Pick best match","        best_match, best_score = max(similarities, key=lambda x: x[1])","","        return {","            \"matched_email\": best_match,","            \"similarity_score\": best_score","        }",""],"id":1}],[{"start":{"row":38,"column":4},"end":{"row":38,"column":8},"action":"remove","lines":["    "],"id":2}],[{"start":{"row":38,"column":4},"end":{"row":38,"column":8},"action":"insert","lines":["    "],"id":3}],[{"start":{"row":5,"column":81},"end":{"row":6,"column":0},"action":"insert","lines":["",""],"id":4},{"start":{"row":6,"column":0},"end":{"row":6,"column":4},"action":"insert","lines":["    "]},{"start":{"row":6,"column":4},"end":{"row":6,"column":5},"action":"insert","lines":["#"]}],[{"start":{"row":6,"column":5},"end":{"row":6,"column":6},"action":"insert","lines":["C"],"id":5},{"start":{"row":6,"column":6},"end":{"row":6,"column":7},"action":"insert","lines":["l"]},{"start":{"row":6,"column":7},"end":{"row":6,"column":8},"action":"insert","lines":["a"]},{"start":{"row":6,"column":8},"end":{"row":6,"column":9},"action":"insert","lines":["s"]},{"start":{"row":6,"column":9},"end":{"row":6,"column":10},"action":"insert","lines":["s"]},{"start":{"row":6,"column":10},"end":{"row":6,"column":11},"action":"insert","lines":["i"]},{"start":{"row":6,"column":11},"end":{"row":6,"column":12},"action":"insert","lines":["f"]},{"start":{"row":6,"column":12},"end":{"row":6,"column":13},"action":"insert","lines":["i"]},{"start":{"row":6,"column":13},"end":{"row":6,"column":14},"action":"insert","lines":["c"]},{"start":{"row":6,"column":14},"end":{"row":6,"column":15},"action":"insert","lines":["a"]},{"start":{"row":6,"column":15},"end":{"row":6,"column":16},"action":"insert","lines":["t"]},{"start":{"row":6,"column":16},"end":{"row":6,"column":17},"action":"insert","lines":["i"]},{"start":{"row":6,"column":17},"end":{"row":6,"column":18},"action":"insert","lines":["o"]},{"start":{"row":6,"column":18},"end":{"row":6,"column":19},"action":"insert","lines":["n"]}],[{"start":{"row":6,"column":19},"end":{"row":6,"column":20},"action":"insert","lines":[" "],"id":6},{"start":{"row":6,"column":20},"end":{"row":6,"column":21},"action":"insert","lines":["b"]},{"start":{"row":6,"column":21},"end":{"row":6,"column":22},"action":"insert","lines":["y"]}],[{"start":{"row":6,"column":22},"end":{"row":6,"column":23},"action":"insert","lines":[" "],"id":7},{"start":{"row":6,"column":23},"end":{"row":6,"column":24},"action":"insert","lines":["e"]},{"start":{"row":6,"column":24},"end":{"row":6,"column":25},"action":"insert","lines":["m"]},{"start":{"row":6,"column":25},"end":{"row":6,"column":26},"action":"insert","lines":["a"]},{"start":{"row":6,"column":26},"end":{"row":6,"column":27},"action":"insert","lines":["i"]},{"start":{"row":6,"column":27},"end":{"row":6,"column":28},"action":"insert","lines":["l"]},{"start":{"row":6,"column":28},"end":{"row":6,"column":29},"action":"insert","lines":["-"]},{"start":{"row":6,"column":29},"end":{"row":6,"column":30},"action":"insert","lines":["t"]},{"start":{"row":6,"column":30},"end":{"row":6,"column":31},"action":"insert","lines":["o"]},{"start":{"row":6,"column":31},"end":{"row":6,"column":32},"action":"insert","lines":["-"]}],[{"start":{"row":6,"column":32},"end":{"row":6,"column":33},"action":"insert","lines":["e"],"id":8},{"start":{"row":6,"column":33},"end":{"row":6,"column":34},"action":"insert","lines":["e"]}],[{"start":{"row":6,"column":33},"end":{"row":6,"column":34},"action":"remove","lines":["e"],"id":9}],[{"start":{"row":6,"column":33},"end":{"row":6,"column":34},"action":"insert","lines":["m"],"id":10},{"start":{"row":6,"column":34},"end":{"row":6,"column":35},"action":"insert","lines":["a"]},{"start":{"row":6,"column":35},"end":{"row":6,"column":36},"action":"insert","lines":["i"]},{"start":{"row":6,"column":36},"end":{"row":6,"column":37},"action":"insert","lines":["l"]}],[{"start":{"row":6,"column":37},"end":{"row":6,"column":38},"action":"insert","lines":[" "],"id":11},{"start":{"row":6,"column":38},"end":{"row":6,"column":39},"action":"insert","lines":["s"]},{"start":{"row":6,"column":39},"end":{"row":6,"column":40},"action":"insert","lines":["i"]},{"start":{"row":6,"column":40},"end":{"row":6,"column":41},"action":"insert","lines":["m"]},{"start":{"row":6,"column":41},"end":{"row":6,"column":42},"action":"insert","lines":["i"]},{"start":{"row":6,"column":42},"end":{"row":6,"column":43},"action":"insert","lines":["l"]},{"start":{"row":6,"column":43},"end":{"row":6,"column":44},"action":"insert","lines":["a"]},{"start":{"row":6,"column":44},"end":{"row":6,"column":45},"action":"insert","lines":["r"]},{"start":{"row":6,"column":45},"end":{"row":6,"column":46},"action":"insert","lines":["i"]},{"start":{"row":6,"column":46},"end":{"row":6,"column":47},"action":"insert","lines":["t"]},{"start":{"row":6,"column":47},"end":{"row":6,"column":48},"action":"insert","lines":["y"]}],[{"start":{"row":6,"column":48},"end":{"row":6,"column":49},"action":"insert","lines":[" "],"id":12}],[{"start":{"row":6,"column":49},"end":{"row":6,"column":51},"action":"insert","lines":["()"],"id":13}],[{"start":{"row":6,"column":50},"end":{"row":6,"column":51},"action":"insert","lines":["c"],"id":14},{"start":{"row":6,"column":51},"end":{"row":6,"column":52},"action":"insert","lines":["o"]},{"start":{"row":6,"column":52},"end":{"row":6,"column":53},"action":"insert","lines":["s"]},{"start":{"row":6,"column":53},"end":{"row":6,"column":54},"action":"insert","lines":["i"]},{"start":{"row":6,"column":54},"end":{"row":6,"column":55},"action":"insert","lines":["n"]},{"start":{"row":6,"column":55},"end":{"row":6,"column":56},"action":"insert","lines":["e"]}],[{"start":{"row":6,"column":56},"end":{"row":6,"column":57},"action":"insert","lines":[" "],"id":15},{"start":{"row":6,"column":57},"end":{"row":6,"column":58},"action":"insert","lines":["s"]},{"start":{"row":6,"column":58},"end":{"row":6,"column":59},"action":"insert","lines":["i"]},{"start":{"row":6,"column":59},"end":{"row":6,"column":60},"action":"insert","lines":["m"]},{"start":{"row":6,"column":60},"end":{"row":6,"column":61},"action":"insert","lines":["i"]},{"start":{"row":6,"column":61},"end":{"row":6,"column":62},"action":"insert","lines":["l"]},{"start":{"row":6,"column":62},"end":{"row":6,"column":63},"action":"insert","lines":["a"]},{"start":{"row":6,"column":63},"end":{"row":6,"column":64},"action":"insert","lines":["r"]},{"start":{"row":6,"column":64},"end":{"row":6,"column":65},"action":"insert","lines":["i"]},{"start":{"row":6,"column":65},"end":{"row":6,"column":66},"action":"insert","lines":["t"]},{"start":{"row":6,"column":66},"end":{"row":6,"column":67},"action":"insert","lines":["y"]}],[{"start":{"row":6,"column":67},"end":{"row":6,"column":68},"action":"insert","lines":[" "],"id":16},{"start":{"row":6,"column":68},"end":{"row":6,"column":69},"action":"insert","lines":["w"]},{"start":{"row":6,"column":69},"end":{"row":6,"column":70},"action":"insert","lines":["i"]},{"start":{"row":6,"column":70},"end":{"row":6,"column":71},"action":"insert","lines":["t"]},{"start":{"row":6,"column":71},"end":{"row":6,"column":72},"action":"insert","lines":["h"]}],[{"start":{"row":6,"column":72},"end":{"row":6,"column":73},"action":"insert","lines":[" "],"id":17},{"start":{"row":6,"column":73},"end":{"row":6,"column":74},"action":"insert","lines":["s"]},{"start":{"row":6,"column":74},"end":{"row":6,"column":75},"action":"insert","lines":["t"]},{"start":{"row":6,"column":75},"end":{"row":6,"column":76},"action":"insert","lines":["o"]},{"start":{"row":6,"column":76},"end":{"row":6,"column":77},"action":"insert","lines":["r"]},{"start":{"row":6,"column":77},"end":{"row":6,"column":78},"action":"insert","lines":["e"]},{"start":{"row":6,"column":78},"end":{"row":6,"column":79},"action":"insert","lines":["d"]}],[{"start":{"row":6,"column":79},"end":{"row":6,"column":80},"action":"insert","lines":[" "],"id":18},{"start":{"row":6,"column":80},"end":{"row":6,"column":81},"action":"insert","lines":["e"]},{"start":{"row":6,"column":81},"end":{"row":6,"column":82},"action":"insert","lines":["m"]},{"start":{"row":6,"column":82},"end":{"row":6,"column":83},"action":"insert","lines":["a"]},{"start":{"row":6,"column":83},"end":{"row":6,"column":84},"action":"insert","lines":["i"]},{"start":{"row":6,"column":84},"end":{"row":6,"column":85},"action":"insert","lines":["l"]},{"start":{"row":6,"column":85},"end":{"row":6,"column":86},"action":"insert","lines":["s"]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":43,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1758501724285}